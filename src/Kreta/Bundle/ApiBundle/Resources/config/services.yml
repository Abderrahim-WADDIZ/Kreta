# This file belongs to Kreta.
# The source code of application includes a LICENSE file
# with all information about license.
#
# @author benatespina <benatespina@gmail.com>
# @author gorkalaucirica <gorka.lauzirika@gmail.com>

services:
    kreta_api.command.create_client:
        class: Kreta\Bundle\ApiBundle\Command\CreateClientCommand
        calls:
            - [setContainer, ['@service_container']]

    kreta_api.listener.json_exception:
        class: Kreta\Bundle\ApiBundle\EventListener\JsonExceptionListener
        tags:
            - { name: kernel.event_listener, event: kernel.exception, method: onKernelException, priority: 200 }

    kreta_api.subscriber.media_url:
        class: Kreta\Bundle\ApiBundle\EventSubscriber\MediaUrlSubscriber
        arguments: [@router]
        tags:
            - { name: jms_serializer.event_subscriber }

    kreta_api.form_handler.abstract:
        abstract: true
        arguments: [@form.factory, @doctrine.orm.entity_manager, @event_dispatcher]

    kreta_api.form_handler.project:
        class: Kreta\Bundle\ApiBundle\Form\Handler\ProjectHandler
        parent: kreta_api.form_handler.abstract
        arguments: [@kreta_media.factory.media, @kreta_project.uploader.image_project, @security.context, @kreta_project.factory.project, @kreta_workflow.repository.workflow]

    kreta_api.form_handler.issue:
        class: Kreta\Bundle\ApiBundle\Form\Handler\IssueHandler
        parent: kreta_api.form_handler.abstract
        arguments: [@security.context, @kreta_issue.factory.issue]

    kreta_api.form_handler.status:
        class: Kreta\Bundle\ApiBundle\Form\Handler\StatusHandler
        parent: kreta_api.form_handler.abstract
        arguments: [@kreta_workflow.factory.status]

    kreta_api.form_handler.status_transition:
        class: Kreta\Bundle\ApiBundle\Form\Handler\StatusTransitionHandler
        parent: kreta_api.form_handler.abstract
        arguments: [@kreta_workflow.factory.status_transition, @kreta_workflow.repository.status]

    kreta_api.form_handler.workflow:
        class: Kreta\Bundle\ApiBundle\Form\Handler\WorkflowHandler
        parent: kreta_api.form_handler.abstract
        arguments: [@security.context, @kreta_workflow.factory.workflow]
